# çœ‹æ¶¨æœŸæƒToken (Call Option Token)

ä¸€ä¸ªåŸºäºŽERC20æ ‡å‡†çš„çœ‹æ¶¨æœŸæƒTokenæ™ºèƒ½åˆçº¦ç³»ç»Ÿï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºã€äº¤æ˜“å’Œè¡ŒæƒETHçœ‹æ¶¨æœŸæƒã€‚

## ðŸ“‹ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **æœŸæƒåˆ›å»º**: é¡¹ç›®æ–¹å¯ä»¥è®¾å®šè¡Œæƒä»·æ ¼ã€åˆ°æœŸæ—¶é—´å’Œæ ‡çš„ä»·æ ¼åˆ›å»ºæœŸæƒ
- **æœŸæƒå‘è¡Œ**: é¡¹ç›®æ–¹å­˜å…¥ETHï¼ŒæŒ‰1:1æ¯”ä¾‹å‘è¡ŒæœŸæƒToken
- **æœŸæƒäº¤æ˜“**: æœŸæƒTokenå¯ä»¥ä¸ŽUSDTåˆ›å»ºäº¤æ˜“å¯¹ï¼Œæ¨¡æ‹ŸæœŸæƒè´­ä¹°
- **æœŸæƒè¡Œæƒ**: ç”¨æˆ·åœ¨åˆ°æœŸæ—¥å¯æŒ‰è¡Œæƒä»·æ ¼ç”¨æœŸæƒTokenå…‘æ¢ETH
- **è¿‡æœŸé”€æ¯**: é¡¹ç›®æ–¹å¯åœ¨è¿‡æœŸåŽé”€æ¯æœªè¡Œæƒçš„æœŸæƒTokenå¹¶èµŽå›žETH

### å®‰å…¨ç‰¹æ€§
- **é‡å…¥æ”»å‡»é˜²æŠ¤**: ä½¿ç”¨OpenZeppelinçš„ReentrancyGuard
- **æƒé™æŽ§åˆ¶**: åŸºäºŽOwnableçš„è®¿é—®æŽ§åˆ¶
- **å®‰å…¨è½¬è´¦**: ä½¿ç”¨callæ–¹æ³•æ›¿ä»£transferï¼Œé¿å…gasé™åˆ¶é—®é¢˜
- **å®Œæ•´äº‹ä»¶æ—¥å¿—**: æ‰€æœ‰é‡è¦æ“ä½œéƒ½æœ‰äº‹ä»¶è®°å½•
- **é”™è¯¯å¤„ç†**: è‡ªå®šä¹‰é”™è¯¯ç±»åž‹ï¼Œæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

## ðŸ—ï¸ åˆçº¦æž¶æž„

### ä¸»è¦åˆçº¦

1. **CallOptionToken.sol** - ä¸»è¦çš„æœŸæƒTokenåˆçº¦
   - ç»§æ‰¿ERC20, Ownable, ReentrancyGuard
   - å®žçŽ°æœŸæƒçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†

2. **MockUSDT.sol** - USDTæ¨¡æ‹Ÿåˆçº¦
   - ç”¨äºŽä¸ŽæœŸæƒTokenåˆ›å»ºäº¤æ˜“å¯¹
   - æ”¯æŒé“¸é€ ã€é”€æ¯ã€æ‰¹é‡è½¬è´¦ç­‰åŠŸèƒ½

### å…³é”®å‚æ•°

```solidity
struct OptionParameters {
    uint256 strikePrice;      // è¡Œæƒä»·æ ¼ (wei)
    uint256 expirationTime;   // åˆ°æœŸæ—¶é—´ (timestamp)
    uint256 underlyingPrice;  // åˆ›å»ºæ—¶æ ‡çš„ä»·æ ¼ (wei)
}
```

## ðŸš€ å¿«é€Ÿå¼€å§‹

### çŽ¯å¢ƒè¦æ±‚

- Foundry (forge, cast, anvil)
- Solidity ^0.8.19
- OpenZeppelin Contracts

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…Foundry (å¦‚æžœè¿˜æ²¡æœ‰å®‰è£…)
curl -L https://foundry.paradigm.xyz | bash
foundryup

# åˆå§‹åŒ–é¡¹ç›®
forge init

# å®‰è£…OpenZeppelinåˆçº¦
forge install OpenZeppelin/openzeppelin-contracts
```

### ç¼–è¯‘åˆçº¦

```bash
forge build
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test

# è¿è¡Œç‰¹å®šæµ‹è¯•å¹¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
forge test --match-test testCompleteOptionLifecycle -vvv

# è¿è¡ŒFuzzæµ‹è¯•
forge test --match-test testFuzz -vvv
```

### éƒ¨ç½²åˆçº¦

```bash
# è®¾ç½®çŽ¯å¢ƒå˜é‡
export PRIVATE_KEY=your_private_key_here
export RPC_URL=your_rpc_url_here

# éƒ¨ç½²åˆ°æœ¬åœ°æµ‹è¯•ç½‘
forge script script/DeployCallOption.s.sol:DeployCallOption --rpc-url $RPC_URL --private-key $PRIVATE_KEY --broadcast

# éƒ¨ç½²å¹¶æ¼”ç¤ºåŠŸèƒ½
forge script script/DeployCallOption.s.sol:DeployAndDemo --rpc-url $RPC_URL --private-key $PRIVATE_KEY --broadcast
```

## ðŸ“– ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»ºæœŸæƒ

```solidity
// éƒ¨ç½²æœŸæƒåˆçº¦
CallOptionToken option = new CallOptionToken(
    "ETH Call Option 2000",  // åç§°
    "ETH-CALL-2000",         // ç¬¦å·
    2000 ether,              // è¡Œæƒä»·æ ¼
    block.timestamp + 7 days, // åˆ°æœŸæ—¶é—´
    1800 ether               // å½“å‰ETHä»·æ ¼
);
```

### 2. å‘è¡ŒæœŸæƒToken

```solidity
// é¡¹ç›®æ–¹å­˜å…¥10 ETHï¼Œå‘è¡Œ10ä¸ªæœŸæƒToken
option.issueOptions{value: 10 ether}();
```

### 3. è½¬è´¦æœŸæƒToken

```solidity
// è½¬è´¦2ä¸ªæœŸæƒTokenç»™ç”¨æˆ·
option.transfer(userAddress, 2 ether);
```

### 4. è¡ŒæƒæœŸæƒ

```solidity
// ç”¨æˆ·åœ¨åˆ°æœŸæ—¥è¡Œæƒ1ä¸ªæœŸæƒToken
// éœ€è¦æ”¯ä»˜è¡Œæƒä»·æ ¼: 1 * 2000 = 2000 ETH
option.exerciseOptions{value: 2000 ether}(1 ether);
```

### 5. é”€æ¯è¿‡æœŸæœŸæƒ

```solidity
// é¡¹ç›®æ–¹åœ¨è¿‡æœŸåŽé”€æ¯æœªè¡Œæƒçš„æœŸæƒToken
option.destroyExpiredOptions();
```

## ðŸ§ª æµ‹è¯•ç”¨ä¾‹

æµ‹è¯•å¥—ä»¶åŒ…å«ä»¥ä¸‹åœºæ™¯ï¼š

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- âœ… åˆçº¦åˆå§‹åŒ–
- âœ… æœŸæƒå‘è¡Œ
- âœ… æœŸæƒè½¬è´¦
- âœ… æœŸæƒè¡Œæƒ
- âœ… è¿‡æœŸé”€æ¯

### è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- âœ… æ— æ•ˆå‚æ•°å¤„ç†
- âœ… æƒé™æŽ§åˆ¶
- âœ… æ—¶é—´é™åˆ¶
- âœ… ä½™é¢æ£€æŸ¥
- âœ… æ”¯ä»˜éªŒè¯

### å®‰å…¨æ€§æµ‹è¯•
- âœ… é‡å…¥æ”»å‡»é˜²æŠ¤
- âœ… æ•´æ•°æº¢å‡ºä¿æŠ¤
- âœ… é›¶åœ°å€æ£€æŸ¥
- âœ… ç´§æ€¥æå–åŠŸèƒ½

### Fuzzæµ‹è¯•
- âœ… éšæœºé‡‘é¢å‘è¡Œ
- âœ… éšæœºé‡‘é¢è¡Œæƒ
- âœ… è¾¹ç•Œå€¼æµ‹è¯•

## ðŸ“Š æœŸæƒå®šä»·æ¨¡åž‹

### å†…åœ¨ä»·å€¼è®¡ç®—

```solidity
function intrinsicValue(uint256 currentPrice) external view returns (uint256) {
    if (currentPrice > strikePrice) {
        return currentPrice - strikePrice;
    }
    return 0;
}
```

### æœŸæƒçŠ¶æ€æ£€æŸ¥

```solidity
function canExercise() external view returns (bool) {
    return block.timestamp >= expirationTime && 
           block.timestamp <= expirationTime + 1 days && 
           !isExpired;
}
```

## ðŸ”§ é…ç½®å‚æ•°

### é»˜è®¤é…ç½®

```solidity
// æµ‹è¯•çŽ¯å¢ƒé…ç½®
uint256 public constant STRIKE_PRICE = 2000 ether;     // è¡Œæƒä»·æ ¼
uint256 public constant UNDERLYING_PRICE = 1800 ether; // æ ‡çš„ä»·æ ¼
uint256 public constant EXPIRATION_DAYS = 7;           // åˆ°æœŸå¤©æ•°
uint256 public constant EXERCISE_WINDOW = 1 days;      // è¡Œæƒçª—å£æœŸ
```

### è‡ªå®šä¹‰é…ç½®

å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š
- è¡Œæƒä»·æ ¼ (strikePrice)
- åˆ°æœŸæ—¶é—´ (expirationTime)
- æ ‡çš„ä»·æ ¼ (underlyingPrice)
- è¡Œæƒçª—å£æœŸ (ç›®å‰å›ºå®šä¸º1å¤©)

## ðŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### å·²å®žçŽ°çš„å®‰å…¨æŽªæ–½

1. **é‡å…¥æ”»å‡»é˜²æŠ¤**: æ‰€æœ‰å¤–éƒ¨è°ƒç”¨ä½¿ç”¨nonReentrantä¿®é¥°ç¬¦
2. **å®‰å…¨è½¬è´¦**: ä½¿ç”¨callæ–¹æ³•æ›¿ä»£transferï¼Œé¿å…gasé™åˆ¶
3. **æƒé™æŽ§åˆ¶**: å…³é”®åŠŸèƒ½ä»…é™åˆçº¦æ‰€æœ‰è€…è°ƒç”¨
4. **å‚æ•°éªŒè¯**: æž„é€ å‡½æ•°å’Œå…³é”®å‡½æ•°éƒ½æœ‰å‚æ•°éªŒè¯
5. **äº‹ä»¶æ—¥å¿—**: å®Œæ•´çš„äº‹ä»¶è®°å½•ä¾¿äºŽç›‘æŽ§å’Œå®¡è®¡
6. **é”™è¯¯å¤„ç†**: è‡ªå®šä¹‰é”™è¯¯ç±»åž‹æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### æ½œåœ¨é£Žé™©

1. **ä»·æ ¼æ“çºµ**: ä¾èµ–å¤–éƒ¨ä»·æ ¼æºï¼Œå¯èƒ½å­˜åœ¨ä»·æ ¼æ“çºµé£Žé™©
2. **æµåŠ¨æ€§é£Žé™©**: æœŸæƒTokençš„æµåŠ¨æ€§ä¾èµ–äºŽå¸‚åœºéœ€æ±‚
3. **æ™ºèƒ½åˆçº¦é£Žé™©**: ä»£ç æ¼æ´žå¯èƒ½å¯¼è‡´èµ„é‡‘æŸå¤±
4. **ç›‘ç®¡é£Žé™©**: æœŸæƒäº¤æ˜“å¯èƒ½é¢ä¸´ç›‘ç®¡é™åˆ¶

## ðŸ“ˆ ä½¿ç”¨åœºæ™¯

### 1. æŠ•æœºäº¤æ˜“
- ç”¨æˆ·çœ‹æ¶¨ETHä»·æ ¼ï¼Œè´­ä¹°çœ‹æ¶¨æœŸæƒ
- å¦‚æžœETHä»·æ ¼ä¸Šæ¶¨è¶…è¿‡è¡Œæƒä»·æ ¼ï¼Œå¯ä»¥èŽ·å¾—æ”¶ç›Š

### 2. é£Žé™©å¯¹å†²
- ETHæŒæœ‰è€…å¯ä»¥å–å‡ºçœ‹æ¶¨æœŸæƒèŽ·å¾—æƒåˆ©é‡‘
- ä¸ºETHæŒä»“æä¾›é¢å¤–æ”¶ç›Š

### 3. å¥—åˆ©äº¤æ˜“
- åœ¨ä¸åŒå¹³å°é—´è¿›è¡ŒæœŸæƒå¥—åˆ©
- åˆ©ç”¨ä»·æ ¼å·®å¼‚èŽ·å¾—æ— é£Žé™©æ”¶ç›Š

## ðŸ”® æœªæ¥æ”¹è¿›

### è®¡åˆ’ä¸­çš„åŠŸèƒ½

1. **çœ‹è·ŒæœŸæƒ**: æ·»åŠ çœ‹è·ŒæœŸæƒæ”¯æŒ
2. **è‡ªåŠ¨è¡Œæƒ**: åœ¨æœ‰åˆ©å¯å›¾æ—¶è‡ªåŠ¨è¡Œæƒ
3. **æœŸæƒé“¾**: æ”¯æŒå¤šä¸ªè¡Œæƒä»·æ ¼å’Œåˆ°æœŸæ—¶é—´
4. **æµåŠ¨æ€§æŒ–çŸ¿**: ä¸ºæœŸæƒæä¾›è€…æä¾›ä»£å¸å¥–åŠ±
5. **ä»·æ ¼é¢„è¨€æœº**: é›†æˆChainlinkç­‰ä»·æ ¼é¢„è¨€æœº
6. **æœŸæƒå®šä»·æ¨¡åž‹**: å®žçŽ°Black-Scholesç­‰å®šä»·æ¨¡åž‹

### æŠ€æœ¯ä¼˜åŒ–

1. **Gasä¼˜åŒ–**: å‡å°‘äº¤æ˜“æˆæœ¬
2. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡è¡Œæƒå’Œè½¬è´¦
3. **å‡çº§æœºåˆ¶**: å®žçŽ°åˆçº¦å‡çº§åŠŸèƒ½
4. **å¤šé“¾éƒ¨ç½²**: æ”¯æŒå¤šä¸ªåŒºå—é“¾ç½‘ç»œ

## ðŸ“ž è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- GitHub Issues: [é¡¹ç›®åœ°å€]
- Email: [è”ç³»é‚®ç®±]
- Discord: [Discordé¢‘é“]

## ðŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

**å…è´£å£°æ˜Ž**: æœ¬é¡¹ç›®ä»…ç”¨äºŽæ•™è‚²å’Œç ”ç©¶ç›®çš„ã€‚åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·è¿›è¡Œå……åˆ†çš„å®‰å…¨å®¡è®¡ã€‚æŠ•èµ„æœ‰é£Žé™©ï¼Œè¯·è°¨æ…Žå†³ç­–ã€‚